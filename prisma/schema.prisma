generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id          String       @id @default(uuid()) @db.Uuid
  first_name  String?
  avatar      String?
  last_name   String?
  email       String       @unique
  password    String
  facebook    String?
  linkedin    String?
  birth_date  DateTime?    @db.Date
  gender      GENDER_TYPE  @default(MALE)
  roll_number Int?
  created_at  DateTime     @default(now()) @db.Timestamp(6)
  updated_at  DateTime     @updatedAt @db.Timestamp(6)
  isverified  Boolean?     @default(false)
  is_complete Boolean?     @default(false)
  admin       Admin?
  comments    Comment[]
  developer   Developer?
  member      Member?
  participant Participant?
}

model Developer {
  id      String @id @default(uuid()) @db.Uuid
  user_id String @unique @db.Uuid
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model Member {
  id             String                  @id @default(uuid()) @db.Uuid
  user_id        String                  @unique @db.Uuid
  status         MemberStatus            @default(PENDING)
  approved_at    DateTime?
  approved_by_id String?                 @db.Uuid
  isAdmin        Admin?                  @relation("MustBeMemberFirst")
  club_appoint   Club_Appointment[]
  dept_allocs    Dept_Allocations[]
  exec_appoint   Executive_Appointment[]
  approved_by    Admin?                  @relation("MembersApprovedbyThisAdmin", fields: [approved_by_id], references: [id])
  user           User                    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model Admin {
  id               String   @id @default(uuid()) @db.Uuid
  user_id          String   @unique @db.Uuid
  member_id        String?  @unique @db.Uuid
  approved_at      DateTime @default(now())
  approved_by_id   String?  @db.Uuid
  approved_by      Admin?   @relation("AdminApprovals", fields: [approved_by_id], references: [id])
  admin_approvals  Admin[]  @relation("AdminApprovals")
  member           Member?  @relation("MustBeMemberFirst", fields: [member_id], references: [id], onDelete: Cascade)
  user             User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  events           Event[]
  member_approvals Member[] @relation("MembersApprovedbyThisAdmin")
  posts            Post[]
}

model Executive_Appointment {
  id           String     @id @default(uuid()) @db.Uuid
  role         EXEC_ROLES
  member_id    String     @db.Uuid
  active       Boolean    @default(true)
  appointed_at DateTime   @default(now())
  revoked_at   DateTime?
  member       Member     @relation(fields: [member_id], references: [id], onDelete: Cascade)

  @@unique([role, active])
}

model Club_Appointment {
  id           String     @id @default(uuid()) @db.Uuid
  role         CLUB_ROLES
  member_id    String     @db.Uuid
  active       Boolean    @default(true)
  appointed_at DateTime   @default(now())
  revoked_at   DateTime?
  member       Member     @relation(fields: [member_id], references: [id], onDelete: Cascade)

  @@unique([role, active])
}

model Participant {
  id             String             @id @default(uuid()) @db.Uuid
  user_id        String             @unique @db.Uuid
  study_level    StudyLevel
  institution_id String?            @db.Uuid
  events         EventParticipant[]
  institution    Institution?       @relation(fields: [institution_id], references: [id])
  user           User               @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([institution_id])
}

model Institution {
  id           String        @id @default(uuid()) @db.Uuid
  name         String        @unique
  location     String?
  eiin         Int?
  participants Participant[]
}

model Announcement {
  id         String           @id @default(uuid()) @db.Uuid
  title      String
  content    String
  category   AnnouncementType
  created_at DateTime         @default(now()) @db.Timestamp(6)
  updated_at DateTime         @updatedAt @db.Timestamp(6)
}

model Event {
  id           String             @id @default(uuid()) @db.Uuid
  title        String
  summary      String             @default("No summary available")
  description  String
  type         EventType          @default(ONLINE)
  image_url    String?
  tags         String[]
  status       EventStatus        @default(UPCOMING)
  sponsors     String[]
  starts_at    DateTime
  ends_at      DateTime
  admin_id     String             @db.Uuid
  created_at   DateTime           @default(now()) @db.Timestamp(6)
  created_by   Admin              @relation(fields: [admin_id], references: [id])
  participants EventParticipant[]
  sub_events   SubEvent[]

  @@index([starts_at, created_at])
}

model SubEvent {
  id           String             @id @default(uuid()) @db.Uuid
  event_id     String             @db.Uuid
  title        String
  description  String?
  image_url    String?
  starts_at    DateTime?
  ends_at      DateTime?
  participants EventParticipant[]
  event        Event              @relation(fields: [event_id], references: [id], onDelete: Cascade)

  @@index([event_id])
}

model EventParticipant {
  id                  String             @id @default(uuid()) @db.Uuid
  event_id            String             @db.Uuid
  sub_event_id        String?            @db.Uuid
  participant_id      String             @db.Uuid
  registration_status RegistrationStatus @default(PENDING)
  created_at          DateTime           @default(now()) @db.Timestamp(6)
  registered_at       DateTime?          @db.Timestamp(6)
  event               Event              @relation(fields: [event_id], references: [id], onDelete: Cascade)
  participant         Participant        @relation(fields: [participant_id], references: [id], onDelete: Cascade)
  sub_event           SubEvent?          @relation(fields: [sub_event_id], references: [id], onDelete: Cascade)

  @@unique([event_id, sub_event_id, participant_id])
  @@index([participant_id])
}

model Post {
  id         String     @id @default(uuid()) @db.Uuid
  title      String
  content    String
  image_urls String[]
  tags       String[]
  status     PostStatus @default(PENDING)
  admin_id   String?    @db.Uuid
  created_at DateTime   @default(now()) @db.Timestamp(6)
  updated_at DateTime   @updatedAt @db.Timestamp(6)
  comments   Comment[]
  created_by Admin?     @relation(fields: [admin_id], references: [id])

  @@index([admin_id, created_at])
}

model Comment {
  id         String   @id @default(uuid()) @db.Uuid
  user_id    String   @db.Uuid
  post_id    String   @db.Uuid
  content    String
  likes      Int      @default(0)
  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @updatedAt @db.Timestamp(6)
  post       Post     @relation(fields: [post_id], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([post_id, user_id, created_at])
}

model Department {
  id          String             @id @default(uuid()) @db.Uuid
  slug        String             @unique
  name        String
  description String
  dept_allocs Dept_Allocations[]
}

model Dept_Allocations {
  id         String           @id @default(uuid()) @db.Uuid
  dept_id    String           @db.Uuid
  member_id  String           @db.Uuid
  role       DEPT_APPOINTMENT @default(MEMBER)
  speciality String
  department Department       @relation(fields: [dept_id], references: [id], onDelete: Cascade)
  member     Member           @relation(fields: [member_id], references: [id], onDelete: Cascade)
}

enum GENDER_TYPE {
  MALE
  FEMALE
  OTHER
}

enum MemberStatus {
  PENDING
  APPROVED
  REJECTED
}

enum CLUB_ROLES {
  MODERATOR
  CO_MODERATOR
}

enum EXEC_ROLES {
  PRESIDENT
  VICE_PRESIDENT
  GENERAL_SECRETARY
  CHIEF_ADVISOR
  ADVISOR
  ORGANIZER
}

enum StudyLevel {
  SIX
  SEVEN
  EIGHT
  NINE
  TEN
  SSC
  O_LEVEL
  HSC
  A_LEVEL
  UNIVERSITY
}

enum AnnouncementType {
  NEWS
  ACTIVITIES
}

enum EventType {
  INTRA_CAMPUS
  INTER_CAMPUS
  ONLINE
}

enum EventStatus {
  UPCOMING
  ONGOING
  ENDED
}

enum RegistrationStatus {
  PENDING
  COMPLETED
  CANCELLED
}

enum PostStatus {
  PENDING
  APPROVED
  REJECTED
}

enum DEPT_APPOINTMENT {
  ASSOCIATE_SECRETARY
  MEMBER
}
